<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>GenFind – mobil demo</title>
  <style>
    :root{
      --bg:#f5f1e8; --surface:#fffdf7; --card:#fff; --text:#0b2b1e; --muted:#5a6d62;
      --line:rgba(11,43,30,.09); --accent:#1f6f4a; --accent2:#154f37; --teal:#4fb6a6;
      --warm:#c57a4d; --soft:rgba(31,111,74,.1); --shadow:0 18px 40px rgba(11,43,30,.12);
      --radius:24px;
    }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{height:100%;margin:0}
    body{
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 600px at 10% -10%, rgba(79,182,166,.18), transparent 52%),
        radial-gradient(900px 700px at 100% 0%, rgba(31,111,74,.16), transparent 54%),
        linear-gradient(180deg,#edeae1 0%,var(--bg) 48%,#d1cdc3 100%);
      display:flex;align-items:center;justify-content:center;padding:18px;
    }
    .actions.oneAction{
      grid-template-columns:1fr;
    }
    .phone{
      width:min(100%,430px);height:min(calc(100dvh - 36px),900px);position:relative;overflow:hidden;
      border-radius:36px;border:1px solid rgba(11,43,30,.08);
      background:rgba(255,253,247,.9);backdrop-filter:blur(18px);
      box-shadow:0 28px 80px rgba(11,43,30,.17), inset 0 1px 0 rgba(255,255,255,.72);
    }
    .phone::before{
      content:"";position:absolute;top:10px;left:50%;transform:translateX(-50%);
      width:110px;height:28px;border-radius:999px;background:#111;z-index:25
    }
    .app{height:100%;display:flex;flex-direction:column;background:
      radial-gradient(380px 220px at 0 0, rgba(79,182,166,.12), transparent 58%),
      linear-gradient(180deg, rgba(255,255,255,.78), rgba(255,255,255,.62))}
    .status{
      height:44px;padding:10px 18px 0;display:flex;justify-content:space-between;align-items:flex-start;
      font-size:12px;font-weight:850;color:var(--muted);flex:0 0 auto
    }
    .status .icons{display:flex;gap:6px}
    .status .icons span{width:7px;height:7px;border-radius:50%;background:var(--accent);display:block}
    .top{
      padding:10px 16px 12px;position:sticky;top:0;z-index:10;background:rgba(255,253,247,.9);
      border-bottom:1px solid rgba(11,43,30,.05);backdrop-filter:blur(12px)
    }

    .brandRow{
      display:flex;
      align-items:center;
      justify-content:flex-start;
      gap:12px;
      margin-bottom:12px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width:0;
    }

    .logoPill{
      width:120px;
      height:56px;
      border-radius:8px;
      overflow:hidden;
      background:#ffffff;
      box-shadow:0 8px 20px rgba(11,43,30,.08);
      flex:0 0 auto;
    }

    .logo{
      width:100%;
      height:100%;
      display:block;
      object-fit:cover;
      object-position:center;
      border-radius:0;
      background:transparent;
      box-shadow:none;
    }

    .brand{display:flex;align-items:center;gap:12px;min-width:0}

    .label{font-size:11px;font-weight:900;letter-spacing:.08em;text-transform:uppercase;color:var(--muted)}
    .title{margin:2px 0 0;font-size:20px;font-weight:950;line-height:1.05}
    .sub{margin:2px 0 0;font-size:12px;color:var(--muted);font-weight:700}
    .profile{
      display:flex;align-items:center;gap:8px;padding:8px 10px;border-radius:16px;background:rgba(255,255,255,.78);
      border:1px solid var(--line);box-shadow:0 8px 22px rgba(11,43,30,.08)
    }
    .avatar{
      width:34px;height:34px;border-radius:50%;display:grid;place-items:center;color:#fff;font-weight:950;font-size:13px;
      background:linear-gradient(180deg,var(--accent),var(--accent2))
    }
    .profileName{font-size:12px;font-weight:900;line-height:1.1;max-width:108px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .profileMeta{font-size:11px;color:var(--muted);font-weight:850}
    .searchRow{display:grid;grid-template-columns:1fr auto;gap:10px;margin-bottom:10px}
    .search{
      display:flex;align-items:center;gap:10px;height:50px;padding:0 14px;border-radius:18px;background:rgba(255,255,255,.9);
      border:1px solid var(--line);box-shadow:inset 0 1px 0 rgba(255,255,255,.65)
    }
    .search input{width:100%;border:0;outline:0;background:transparent;font:inherit;font-size:15px;color:var(--text)}
    .search svg{
      width:20px;
      height:20px;
      flex:0 0 20px;
      color:var(--muted);
    }

    .iconBtn svg,
    .closeBtn svg{
      width:20px;
      height:20px;
      flex:0 0 20px;
    }

    .search:focus-within,.field input:focus,.field select:focus{border-color:rgba(31,111,74,.24);box-shadow:0 0 0 4px rgba(31,111,74,.08)}
    .iconBtn,.btn,.tabBtn,.closeBtn{border:0;font:inherit;cursor:pointer}
    .iconBtn{
      width:50px;height:50px;border-radius:18px;background:linear-gradient(180deg,var(--accent),var(--accent2));
      color:#fff;display:grid;place-items:center;box-shadow:0 14px 26px rgba(31,111,74,.22)
    }
    .metaRow{display:flex;gap:8px;overflow:auto;scrollbar-width:none;margin-bottom:10px}
    .metaRow::-webkit-scrollbar,.chips::-webkit-scrollbar,.panel::-webkit-scrollbar,.sheetBody::-webkit-scrollbar{display:none}
    .meta{white-space:nowrap;padding:8px 10px;border-radius:14px;background:rgba(255,255,255,.78);border:1px solid var(--line);font-size:12px;font-weight:850;color:var(--muted)}
    .chips{display:flex;gap:8px;overflow:auto;scrollbar-width:none;padding-bottom:2px}
    .chip{
      white-space:nowrap;padding:9px 12px;border-radius:999px;background:rgba(255,255,255,.8);border:1px solid var(--line);
      font-size:13px;font-weight:850;color:var(--text);cursor:pointer
    }
    .chip.active{background:var(--soft);border-color:rgba(31,111,74,.18);color:var(--accent)}
    .main{flex:1;position:relative;overflow:hidden}
    .panel{
      position:absolute;inset:0;overflow:auto;padding:16px 16px 118px;opacity:0;pointer-events:none;
      transform:translateY(6px);transition:.18s ease
    }
    .panel.active{opacity:1;pointer-events:auto;transform:none}
    .hero{
      padding:16px;border-radius:24px;color:#fff;margin-bottom:14px;
      background:radial-gradient(180px 100px at 82% 24%, rgba(255,255,255,.2), transparent 62%),
                 linear-gradient(135deg,var(--accent),var(--teal) 72%,#7fd3c3);
      box-shadow:0 18px 34px rgba(31,111,74,.2)
    }
    .hero h1{margin:0 0 4px;font-size:22px;line-height:1.05}
    .hero p{margin:0;font-size:13px;line-height:1.45;color:rgba(255,255,255,.9)}
    .heroStats{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:14px}
    .heroStat{padding:10px 8px;border-radius:18px;background:rgba(255,255,255,.14);border:1px solid rgba(255,255,255,.18)}
    .heroStat b{display:block;font-size:16px;line-height:1;margin-bottom:4px}
    .heroStat span{display:block;font-size:11px;line-height:1.2;color:rgba(255,255,255,.86);font-weight:800}
    .sectionHead{display:flex;justify-content:space-between;align-items:center;gap:12px;margin:2px 0 12px}
    .sectionHead h2{margin:0;font-size:17px}
    .sectionHead span{font-size:12px;color:var(--muted);font-weight:850}
    .stack{display:grid;gap:12px}
    .card{
      display:grid;grid-template-columns:96px 1fr;gap:12px;padding:10px;border-radius:24px;background:rgba(255,255,255,.92);
      border:1px solid var(--line);box-shadow:0 10px 26px rgba(11,43,30,.08);cursor:pointer
    }
    .card:active{transform:scale(.99)}
    .thumb{width:96px;height:96px;border-radius:18px;overflow:hidden;border:1px solid rgba(11,43,30,.05);background:#f2eee4}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .body{min-width:0;display:flex;flex-direction:column;gap:6px;padding:2px 0}
    .topRow{display:flex;align-items:flex-start;justify-content:space-between;gap:8px}
    .cardTitle{
      margin:0;font-size:15px;line-height:1.25;font-weight:900;display:-webkit-box;-webkit-line-clamp:2;
      -webkit-box-orient:vertical;overflow:hidden
    }
    .pill{
      padding:2px 5px;border-radius:999px;background:var(--soft);color:var(--accent);font-size:11px;font-weight:900;white-space:nowrap
    }
    .pill.warm{background:rgba(197,122,77,.13);color:#9b5f3a}
    .price{font-size:18px;font-weight:950;line-height:1;color:var(--accent)}
    .muted{font-size:12px;line-height:1.35;color:var(--muted)}
    .row{display:flex;justify-content:space-between;align-items:center;gap:8px}
    .tags{display:flex;gap:6px;flex-wrap:wrap;margin-top:auto}
    .tag{padding:5px 8px;border-radius:999px;background:#f5f1e8;font-size:11px;font-weight:850;color:var(--muted)}
    .infoCard{
      padding:16px;border-radius:24px;background:rgba(255,255,255,.92);border:1px solid var(--line);
      box-shadow:0 10px 26px rgba(11,43,30,.08);margin-bottom:14px
    }
    .infoCard h2{margin:0 0 6px;font-size:18px}
    .infoCard p{margin:0;font-size:13px;line-height:1.5;color:var(--muted)}
    .metric{display:flex;justify-content:space-between;align-items:center;gap:10px;padding:12px 14px;border-radius:18px;background:#f7f3ea;border:1px solid rgba(11,43,30,.05);font-size:13px;font-weight:850;color:var(--muted)}
    .metric strong{color:var(--text)}
    .actions{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:14px}
    .btn{
      height:48px;border-radius:18px;display:flex;align-items:center;justify-content:center;gap:8px;font-weight:900
    }
    .btn.primary{background:linear-gradient(180deg,var(--accent),var(--accent2));color:#fff;box-shadow:0 14px 26px rgba(31,111,74,.22)}
    .btn.ghost{background:rgba(255,255,255,.9);border:1px solid var(--line);color:var(--accent);box-shadow:0 8px 22px rgba(11,43,30,.08)}
    .empty{display:none;padding:18px;border-radius:22px;border:1px dashed rgba(11,43,30,.15);background:rgba(255,255,255,.65);font-size:14px;line-height:1.5;color:var(--muted)}
    .tabbar{
      position:absolute;left:14px;right:14px;bottom:14px;height:74px;padding:8px;display:grid;grid-template-columns:repeat(3,1fr);
      border-radius:28px;border:1px solid rgba(11,43,30,.08);background:rgba(255,255,255,.94);box-shadow:var(--shadow);z-index:12
    }
    .tabBtn{
      border-radius:22px;background:transparent;color:var(--muted);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;
      font-size:11px;font-weight:850
    }
    .tabBtn svg{width:20px;height:20px}
    .tabBtn.active{background:var(--soft);color:var(--accent)}
    .overlay{
      position:absolute;inset:0;background:rgba(11,43,30,.42);backdrop-filter:blur(4px);opacity:0;pointer-events:none;transition:.18s ease;z-index:18
    }
    .overlay.open{opacity:1;pointer-events:auto}
    .sheet{
      position:absolute;
      left:0;
      right:0;
      bottom:0;
      transform:translateY(100%);
      transition:transform .22s ease;
      max-height:calc(100% - 12px);
      display:flex;
      flex-direction:column;
      border-radius:10px 10px 0 0;
      background:rgba(255,253,247,.98);
      border-top:1px solid rgba(11,43,30,.06);
      box-shadow:0 -18px 36px rgba(11,43,30,.14);
      overflow:hidden;
    }
    .overlay.open .sheet{transform:none}
    .handle{width:54px;height:5px;border-radius:999px;background:rgba(11,43,30,.16);margin:10px auto 2px;flex:0 0 auto}
    .sheetHead{display:flex;justify-content:space-between;align-items:center;gap:12px;padding:10px 16px 14px;flex:0 0 auto}
    .sheetHead h3{margin:0;font-size:16px}
    .closeBtn{
      width:36px;height:36px;border-radius:12px;display:grid;place-items:center;background:#fff;color:var(--muted);border:1px solid var(--line)
    }
    .sheetBody{padding:0 16px 22px;overflow:auto}

    .detailImage{
      height:140px;
      border-radius:8px;
      overflow:hidden;
      border:1px solid rgba(11,43,30,.05);
      background:#f2eee4;
      margin-bottom:12px;
      cursor:zoom-in;
    }

    .detailImage img{
      width:100%;
      height:100%;
      object-fit:cover;
      object-position:center;
      display:block;
    }

    .imageViewer{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }

    .imageViewer img{
      max-width:100%;
      max-height:100%;
      object-fit:contain;
      border-radius:8px;
      background:#fff;
      box-shadow:0 12px 30px rgba(11,43,30,.22);
    }

    .imageClose{
      position:absolute;
      top:16px;
      right:16px;
      z-index:2;
    }

    .detailTitle{margin:0;font-size:22px;line-height:1.1}
    .detailDesc{margin:10px 0 0;font-size:14px;line-height:1.5;color:var(--muted)}
    .detailGrid{display:grid;gap:10px;margin:16px 0}
    .detailCell{padding:12px 14px;border-radius:18px;background:#fff;border:1px solid rgba(11,43,30,.05)}
    .detailCell small{display:block;font-size:11px;font-weight:900;letter-spacing:.06em;text-transform:uppercase;color:var(--muted);margin-bottom:4px}
    .detailCell strong{display:block;font-size:14px;line-height:1.4}
    .sheetActions{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .fields{display:grid;gap:14px}
    .field{display:grid;gap:8px}
    .field label{font-size:12px;font-weight:900;letter-spacing:.06em;text-transform:uppercase;color:var(--muted)}
    .field input,.field select{
      height:48px;padding:0 14px;border-radius:16px;border:1px solid var(--line);background:#fff;font:inherit;color:var(--text);outline:0
    }
    .toast{
      position:absolute;left:16px;right:16px;bottom:96px;padding:12px 14px;border-radius:16px;
      background:rgba(11,43,30,.92);color:#fff;font-size:13px;font-weight:850;opacity:0;transform:translateY(8px);
      pointer-events:none;transition:.18s ease;z-index:22
    }
    .toast.show{opacity:1;transform:none}
    @media (max-width:560px){
      body{padding:0}
      .phone{width:100%;height:100dvh;border-radius:0;border:0}
    }

    .phone{
      border-radius:26px;
    }

    .logoPill{
      border-radius:8px;
    }

    .search,
    .iconBtn,
    .btn,
    .metric,
    .detailCell,
    .field input,
    .field select{
      border-radius:8px;
    }

    .meta{
      border-radius:12px;
    }

    .card,
    .infoCard{
      border-radius:8px;
    }

    .thumb,
    .detailImage,
    .empty,
    .tabBtn{
      border-radius:8px;
    }

    .tabbar{
      border-radius:8px;
    }

    .sheet{
      border-radius:10px 10px 0 0;
    }

    .closeBtn{
      border-radius:10px;
    }

    .chip,
    .pill,
    .tag{
      border-radius:8px;
    }
  </style>
</head>
<body>
  <div class="phone">
    <div class="app">
      <div class="status">
        <div>9:41</div>
        <div class="icons"><span></span><span></span><span></span></div>
      </div>

      <header class="top">
        <div class="brandRow">
          <div class="brand">
            <div class="logoPill">
              <img class="logo" src="genfind_logo.png" alt="GenFind logo">
            </div>
            <div>
              <div class="label">Genbrugs-app demo</div>
            </div>
          </div>
        </div>

        <div class="searchRow">
          <div class="search">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="7"/><path d="M20 20l-3.5-3.5"/></svg>
            <input id="q" type="search" placeholder="Søg efter sofa, jakke, bog..." autocomplete="off">
          </div>
          <button class="iconBtn" id="openFilters" title="Filtre">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 6h16"/><path d="M7 12h10"/><path d="M10 18h4"/></svg>
          </button>
        </div>

        <div class="metaRow">
          <div class="meta" id="metaLocation">Min lokation: Aarhus H (demo)</div>
          <div class="meta" id="metaResults">0 varer</div>
          <div class="meta" id="metaStore">Alle butikker</div>
        </div>

        <div class="chips" id="catRow"></div>
      </header>

      <main class="main">
        <section class="panel active" id="browsePanel">
          <div class="sectionHead">
            <h2></h2>
            <span id="feedCount">0 resultater</span>
          </div>
          <div class="stack" id="feed"></div>
          <div class="empty" id="feedEmpty">Ingen resultater. Prøv en anden søgning eller ændr filtrene.</div>
        </section>

        <section class="panel" id="savedPanel">
          <div class="infoCard">
            <h2>Gemte varer</h2>
            <p>Her samles favoritter, så du hurtigt kan vende tilbage til dem senere i demoen.</p>

            <div class="actions oneAction">
              <button class="btn ghost" id="clearSavedBtn">Nulstil gemte</button>
            </div>
          </div>

          <div class="sectionHead">
            <h2>Din liste</h2>
            <span id="savedCountLabel">0 gemte</span>
          </div>
          <div class="stack" id="savedList"></div>
          <div class="empty" id="savedEmpty">Du har ingen gemte varer endnu. Åbn en vare og tryk “Gem”.</div>
        </section>

        <section class="panel" id="profilePanel">
          <div class="infoCard">
            <h2>Demo-profil</h2>
            <div class="actions oneAction">
              <button class="btn primary" id="toggleLoginBtn">Log ud (demo)</button>
            </div>
          </div>

          <div class="stack">
            <div class="metric"><span>Bruger</span><strong id="metricUser">Jens Peter Mogensen</strong></div>
            <div class="metric"><span>Status</span><strong id="metricStatus">Logget ind</strong></div>
            <div class="metric"><span>Gemte varer</span><strong id="metricSaved">0</strong></div>
            <div class="metric"><span>Valgt butik</span><strong id="metricStore">Alle butikker</strong></div>
            <div class="metric"><span>Afstandsmode</span><strong id="metricNear">Alle afstande</strong></div>
          </div>
        </section>
      </main>

      <nav class="tabbar">
        <button class="tabBtn active" data-tab="browse">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 11l9-7 9 7"/><path d="M5 10v10h14V10"/></svg>
          Udforsk
        </button>
        <button class="tabBtn" data-tab="saved">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 4h12a1 1 0 0 1 1 1v15l-7-4-7 4V5a1 1 0 0 1 1-1z"/></svg>
          Gemte
        </button>
        <button class="tabBtn" data-tab="profile">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="4"/><path d="M5 20c1.7-3.3 4-5 7-5s5.3 1.7 7 5"/></svg>
          Profil
        </button>
      </nav>
    </div>

    <div class="overlay" id="detailOverlay">
      <div class="sheet">
        <div class="handle"></div>
        <div class="sheetHead">
          <h3>Annonce</h3>
          <button class="closeBtn" data-close="detail" aria-label="Luk annonce">✕</button>
        </div>
        <div class="sheetBody">
          <div class="detailImage" id="detailImageWrap" title="Tryk for at se hele billedet">
            <img id="dImg" alt="Varebillede">
          </div>
          <h2 class="detailTitle" id="dTitle">Titel</h2>
          <div class="row" style="margin-top:8px">
            <div class="price" id="dPrice">0 kr.</div>
            <div class="pill" id="dDist">0,0 km</div>
          </div>
          <p class="detailDesc" id="dDesc">Beskrivelse</p>

          <div class="detailGrid">
            <div class="detailCell"><small>Butik</small><strong id="dStore">—</strong></div>
            <div class="detailCell"><small>Adresse</small><strong id="dAddr">—</strong></div>
            <div class="detailCell"><small>Åbningstid</small><strong id="dHours">—</strong></div>
            <div class="detailCell"><small>Dato</small><strong id="dDate">—</strong></div>
          </div>

          <div class="sheetActions">
            <button class="btn primary" id="visitBtn">Planlæg besøg</button>
            <button class="btn ghost" id="saveBtn">Gem</button>
          </div>
        </div>
      </div>
    </div>

    <div class="overlay" id="filterOverlay">
      <div class="sheet">
        <div class="handle"></div>
        <div class="sheetHead">
          <h3>Filtre</h3>
          <button class="closeBtn" data-close="filter" aria-label="Luk filtre">✕</button>
        </div>
        <div class="sheetBody">
          <div class="fields">
            <div class="field">
              <label for="store">Genbrugsbutik</label>
              <select id="store"><option value="all">Alle genbrugsbutikker</option></select>
            </div>
            <div class="field">
              <label for="sort">Sortér</label>
              <select id="sort">
                <option value="newest">Nyeste</option>
                <option value="distance">Afstand</option>
                <option value="price_asc">Pris (lav → høj)</option>
                <option value="price_desc">Pris (høj → lav)</option>
              </select>
            </div>
            <div class="field">
              <label for="maxPrice">Max pris</label>
              <input id="maxPrice" type="number" min="0" step="10" placeholder="fx 300">
            </div>
            <div class="field">
              <label for="near">Kun nær mig</label>
              <select id="near">
                <option value="all">Alle</option>
                <option value="1">≤ 1 km</option>
                <option value="2">≤ 2 km</option>
                <option value="3">≤ 3 km</option>
                <option value="5">≤ 5 km</option>
                <option value="10">≤ 10 km</option>
                <option value="25">≤ 25 km</option>
              </select>
            </div>
          </div>

          <div class="actions" style="margin-top:18px">
            <button class="btn ghost" id="resetFiltersBtn">Nulstil</button>
            <button class="btn primary" id="applyFiltersBtn">Anvend</button>
          </div>
        </div>
      </div>
    </div>

    <div class="overlay" id="imageOverlay">
      <div class="imageViewer">
        <button class="closeBtn imageClose" data-close="image" aria-label="Luk billede">✕</button>
        <img id="fullImg" alt="Fuldt varebillede">
      </div>
    </div>

    <div class="toast" id="toast"></div>
  </div>

  <script>
    const USER_LOCATION = { label:"Aarhus H (demo)", lat:56.1502, lon:10.2046 };
    const CURRENT_USER = { id:"demo_jens_peter_mogensen", name:"Jens Peter Mogensen" };

    const STORES = [
      { id:"rk_noerrealle_30", name:"Røde Kors", addr:"Nørre Allé 30, 8000 Aarhus", lat:56.1627, lon:10.2126, hours:"08:00–20:00" },
      { id:"rk_silkeborgvej_236", name:"Røde Kors", addr:"Silkeborgvej 236, 8230 Åbyhøj", lat:56.1648, lon:10.1527, hours:"10:00–17:00" },
      { id:"kk_noerrealle_25", name:"Kirkens Korshær", addr:"Nørre Allé 25, 8000 Aarhus", lat:56.1623, lon:10.2116, hours:"09:00–18:00" },
      { id:"kk_vestergade_37", name:"Kirkens Korshær", addr:"Vestergade 37, 8000 Aarhus", lat:56.1557, lon:10.2027, hours:"10:00–16:00" }
    ];

    const CATS = [
      {id:"alle", name:"Alle"},
      {id:"mobler", name:"Møbler"},
      {id:"toj", name:"Tøj"},
      {id:"elektronik", name:"Elektronik"},
      {id:"boger", name:"Bøger"},
      {id:"bolig", name:"Bolig & pynt"}
    ];

    const RAW_ITEMS = [
      {id:"1", cat:"mobler", title:"Vintage sofabord", price:null, storeId:"rk_noerrealle_30", desc:"Egetræsbord i god stand. Små brugsspor.", date:"2026-02-19", img:"images/vintage_sofabord.jpg"},
      {id:"2", cat:"toj", title:"Uldfrakke (L)", price:220, storeId:"rk_noerrealle_30", desc:"Klassisk uldfrakke. Varm og pæn stand.", date:"2026-02-18", img:"images/uldfrakke.jpg"},
      {id:"3", cat:"bolig", title:"Keramikvase", price:110, storeId:"rk_noerrealle_30", desc:"Håndlavet vase med glasur.", date:"2026-02-17", img:"images/keramikvase.jpg"},
      {id:"4", cat:"mobler", title:"Træreol", price:180, storeId:"rk_silkeborgvej_236", desc:"Enkel reol med 4 hylder. Stabil og solid.", date:"2026-02-18", img:"images/traereol.jpg"},
      {id:"5", cat:"elektronik", title:'27" skærm', price:350, storeId:"rk_silkeborgvej_236", desc:"HDMI. Testet og fungerer.", date:"2026-02-15", img:"images/27tommer_skaerm.jpg"},
      {id:"6", cat:"boger", title:"Børnebogsamling (6 stk.)", price:90, storeId:"rk_silkeborgvej_236", desc:"Farverige bøger – fine sider.", date:"2026-02-16", img:"images/boerneboeger.jpg"},
      {id:"7", cat:"mobler", title:"Retro lænestol", price:450, storeId:"kk_noerrealle_25", desc:"Grøn lænestol. God komfort.", date:"2026-02-17", img:"images/retro_laenestol.jpg"},
      {id:"8", cat:"toj", title:"Denimjakke", price:120, storeId:"kk_noerrealle_25", desc:"Klassisk denimjakke. Pæn stand.", date:"2026-02-16", img:"images/denimjakke.jpg"},
      {id:"9", cat:"boger", title:"Krimi-bogpakke (5 stk.)", price:80, storeId:"kk_vestergade_37", desc:"5 krimier. Fine rygge.", date:"2026-02-18", img:"images/krimi_boeger.jpg"},
      {id:"10", cat:"bolig", title:"Messinglysestager (2 stk.)", price:140, storeId:"kk_vestergade_37", desc:"Smuk patina – klassisk look.", date:"2026-02-19", img:"images/messing_lysestager.jpg"},
      {id:"11", cat:"bolig", title:"Spejl (test: intet billede og pris)", storeId:"rk_noerrealle_30", desc:"Test af manglende pris og billede.", date:"2026-02-18", img:"images/spejl.jpg"}
    ];

    const state = {
      activeTab:"browse",
      activeCat:"alle",
      query:"",
      selectedStore:"all",
      sort:"newest",
      maxPrice:"",
      near:"all",
      isLoggedIn:true,
      selectedItem:null,
      saved:new Set(JSON.parse(localStorage.getItem("genfind_mobile_saved") || "[]"))
    };

    const el = {
      q: document.getElementById("q"),
      catRow: document.getElementById("catRow"),
      feed: document.getElementById("feed"),
      feedEmpty: document.getElementById("feedEmpty"),
      feedCount: document.getElementById("feedCount"),
      savedList: document.getElementById("savedList"),
      savedEmpty: document.getElementById("savedEmpty"),
      savedCountLabel: document.getElementById("savedCountLabel"),
      metricUser: document.getElementById("metricUser"),
      metricStatus: document.getElementById("metricStatus"),
      metricSaved: document.getElementById("metricSaved"),
      metricStore: document.getElementById("metricStore"),
      metricNear: document.getElementById("metricNear"),
      metaResults: document.getElementById("metaResults"),
      metaStore: document.getElementById("metaStore"),
      metaLocation: document.getElementById("metaLocation"),
      toggleLoginBtn: document.getElementById("toggleLoginBtn"),
      clearSavedBtn: document.getElementById("clearSavedBtn"),
      tabBtns: [...document.querySelectorAll(".tabBtn")],
      panels: {
        browse: document.getElementById("browsePanel"),
        saved: document.getElementById("savedPanel"),
        profile: document.getElementById("profilePanel")
      },
      openFilters: document.getElementById("openFilters"),
      filterOverlay: document.getElementById("filterOverlay"),
      detailOverlay: document.getElementById("detailOverlay"),
      imageOverlay: document.getElementById("imageOverlay"),
      store: document.getElementById("store"),
      sort: document.getElementById("sort"),
      maxPrice: document.getElementById("maxPrice"),
      near: document.getElementById("near"),
      resetFiltersBtn: document.getElementById("resetFiltersBtn"),
      applyFiltersBtn: document.getElementById("applyFiltersBtn"),
      detailImageWrap: document.getElementById("detailImageWrap"),
      dImg: document.getElementById("dImg"),
      fullImg: document.getElementById("fullImg"),
      dTitle: document.getElementById("dTitle"),
      dPrice: document.getElementById("dPrice"),
      dDist: document.getElementById("dDist"),
      dDesc: document.getElementById("dDesc"),
      dStore: document.getElementById("dStore"),
      dAddr: document.getElementById("dAddr"),
      dHours: document.getElementById("dHours"),
      dDate: document.getElementById("dDate"),
      visitBtn: document.getElementById("visitBtn"),
      saveBtn: document.getElementById("saveBtn"),
      toast: document.getElementById("toast")
    };

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function slugLabel(id){
      return (CATS.find(c => c.id === id)?.name || "Vare");
    }

    function art(item){
      const colors = {
        mobler:["#1f6f4a","#4fb6a6"],
        toj:["#2d5f87","#8ec5e8"],
        elektronik:["#4a4f7a","#9096d4"],
        boger:["#8a5a2c","#d6a56f"],
        bolig:["#a55b4d","#dfaf87"]
      };
      const pair = colors[item.cat] || colors.bolig;
      const title = escapeHtml(item.title);
      const category = escapeHtml(slugLabel(item.cat));
      const svg = `
        <svg xmlns="http://www.w3.org/2000/svg" width="600" height="600">
          <defs>
            <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0%" stop-color="${pair[0]}"/>
              <stop offset="100%" stop-color="${pair[1]}"/>
            </linearGradient>
            <radialGradient id="r" cx="30%" cy="24%" r="70%">
              <stop offset="0%" stop-color="#ffffff" stop-opacity=".6"/>
              <stop offset="100%" stop-color="#ffffff" stop-opacity="0"/>
            </radialGradient>
          </defs>
          <rect width="100%" height="100%" rx="42" fill="#f6f3ea"/>
          <rect x="24" y="24" width="552" height="552" rx="42" fill="url(#g)"/>
          <rect x="24" y="24" width="552" height="552" rx="42" fill="url(#r)"/>
          <rect x="62" y="360" width="476" height="152" rx="28" fill="rgba(255,255,255,.88)"/>
          <text x="88" y="415" font-family="Arial, Helvetica, sans-serif" font-size="28" font-weight="700" fill="#0b2b1e">${category}</text>
          <text x="88" y="458" font-family="Arial, Helvetica, sans-serif" font-size="34" font-weight="800" fill="#0b2b1e">${title}</text>
        </svg>`;
      return "data:image/svg+xml;charset=utf-8," + encodeURIComponent(svg);
    }

    function hasPrice(p){ return p !== null && p !== undefined && p !== "" && Number.isFinite(Number(p)); }
    function priceLabel(p){ return hasPrice(p) ? Number(p) + " kr." : "Pris ikke angivet"; }
    function toRad(x){ return x * Math.PI / 180; }
    function distanceKm(a,b){
      const R = 6371;
      const dLat = toRad(b.lat - a.lat);
      const dLon = toRad(b.lon - a.lon);
      const lat1 = toRad(a.lat);
      const lat2 = toRad(b.lat);
      const s1 = Math.sin(dLat/2), s2 = Math.sin(dLon/2);
      const h = s1*s1 + Math.cos(lat1)*Math.cos(lat2)*s2*s2;
      return 2 * R * Math.asin(Math.min(1, Math.sqrt(h)));
    }
    function storeById(id){ return STORES.find(s => s.id === id) || null; }
    function fmtDate(d){
      return new Date(d + "T12:00:00").toLocaleDateString("da-DK", { day:"2-digit", month:"short", year:"numeric" });
    }

    const ITEMS = RAW_ITEMS.map(item => ({ ...item, img: item.img || art(item) }));

    function decorateItems(list){
      return list.map(x => {
        const s = storeById(x.storeId);
        const dist = s ? distanceKm(USER_LOCATION, s) : 999;
        return {
          ...x,
          storeName: s ? s.name : "Ukendt butik",
          addr: s ? s.addr : "—",
          hours: s ? (s.hours || "Åbningstid ikke angivet") : "Åbningstid ikke angivet",
          dist
        };
      });
    }

    function filteredItems(){
      const q = state.query.trim().toLowerCase();
      const maxPrice = Number(state.maxPrice || 0);
      const near = state.near === "all" ? null : Number(state.near);

      let list = decorateItems(ITEMS);

      if(state.activeCat !== "alle") list = list.filter(x => x.cat === state.activeCat);
      if(state.selectedStore !== "all") list = list.filter(x => x.storeId === state.selectedStore);

      if(q){
        list = list.filter(x =>
          x.title.toLowerCase().includes(q) ||
          x.desc.toLowerCase().includes(q) ||
          x.storeName.toLowerCase().includes(q) ||
          x.addr.toLowerCase().includes(q)
        );
      }

      if(maxPrice > 0){
        list = list.filter(x => !hasPrice(x.price) || Number(x.price) <= maxPrice);
      }

      if(near !== null){
        list = list.filter(x => x.dist <= near);
      }

      switch(state.sort){
        case "distance":
          list.sort((a,b) => a.dist - b.dist);
          break;
        case "price_asc":
          list.sort((a,b) => (hasPrice(a.price) ? Number(a.price) : Infinity) - (hasPrice(b.price) ? Number(b.price) : Infinity));
          break;
        case "price_desc":
          list.sort((a,b) => (hasPrice(b.price) ? Number(b.price) : -Infinity) - (hasPrice(a.price) ? Number(a.price) : -Infinity));
          break;
        default:
          list.sort((a,b) => new Date(b.date) - new Date(a.date));
      }

      return list;
    }

    function persistSaved(){
      localStorage.setItem("genfind_mobile_saved", JSON.stringify([...state.saved]));
    }

    function showToast(text){
      el.toast.textContent = text;
      el.toast.classList.add("show");
      clearTimeout(showToast.t);
      showToast.t = setTimeout(() => el.toast.classList.remove("show"), 1800);
    }

    function cardMarkup(item){
      const saved = state.saved.has(item.id);
      const fallback = art(item);
      const imgSrc = item.img || fallback;

      return `
        <article class="card" data-id="${item.id}">
          <div class="thumb">
            <img
              src="${imgSrc}"
              alt="Billede af ${escapeHtml(item.title)}"
              onerror="this.onerror=null; this.src='${fallback}'"
            >
          </div>
          <div class="body">
            <div class="topRow">
              <h3 class="cardTitle">${escapeHtml(item.title)}</h3>
              <span class="pill ${saved ? "warm" : ""}">${saved ? "Gemt" : item.dist.toFixed(1) + " km"}</span>
            </div>
            <div class="price">${priceLabel(item.price)}</div>
            <div class="muted">${escapeHtml(item.storeName)} · ${escapeHtml(item.addr)}</div>
            <div class="tags">
              <span class="tag">${escapeHtml(slugLabel(item.cat))}</span>
              <span class="tag">${fmtDate(item.date)}</span>
            </div>
          </div>
        </article>`;
    }

    function renderCats(){
      el.catRow.innerHTML = "";
      CATS.forEach(cat => {
        const b = document.createElement("button");
        b.className = "chip" + (state.activeCat === cat.id ? " active" : "");
        b.type = "button";
        b.textContent = cat.name;
        b.onclick = () => {
          state.activeCat = cat.id;
          renderAll();
        };
        el.catRow.appendChild(b);
      });
    }

    function renderHero(list){
      const storeLabel = state.selectedStore === "all"
        ? "Alle butikker"
        : (storeById(state.selectedStore)?.name || "Valgt butik");

      el.metaResults.textContent = list.length + " varer";
      el.metaStore.textContent = storeLabel;
      el.metaLocation.textContent = "Min lokation: " + USER_LOCATION.label;
    }

    function renderFeed(){
      const list = filteredItems();
      el.feed.innerHTML = list.map(cardMarkup).join("");
      el.feedCount.textContent = list.length + " resultater";
      el.feedEmpty.style.display = list.length ? "none" : "block";
      renderHero(list);
    }

    function renderSaved(){
      const list = decorateItems(ITEMS).filter(x => state.saved.has(x.id));
      el.savedList.innerHTML = list.map(cardMarkup).join("");
      el.savedEmpty.style.display = list.length ? "none" : "block";
      el.savedCountLabel.textContent = list.length + " gemte";
    }

    function renderProfile(){
      const storeLabel = state.selectedStore === "all"
        ? "Alle butikker"
        : (storeById(state.selectedStore)?.name || "Valgt butik");

      const nearLabel = state.near === "all" ? "Alle afstande" : "≤ " + state.near + " km";

      el.metricUser.textContent = state.isLoggedIn ? CURRENT_USER.name : "Demo-bruger";
      el.metricStatus.textContent = state.isLoggedIn ? "Logget ind" : "Logget ud";
      el.metricSaved.textContent = String(state.saved.size);
      el.metricStore.textContent = storeLabel;
      el.metricNear.textContent = nearLabel;
      el.toggleLoginBtn.textContent = state.isLoggedIn ? "Log ud (demo)" : "Log ind (demo)";
    }

    function renderAll(){
      renderCats();
      renderFeed();
      renderSaved();
      renderProfile();
      persistSaved();
    }

    function openDetail(id){
      const item = decorateItems(ITEMS).find(x => x.id === id);
      if(!item) return;

      state.selectedItem = item;

      const fallback = art(item);
      el.dImg.onerror = () => {
        el.dImg.onerror = null;
        el.dImg.src = fallback;
      };
      el.dImg.src = item.img || fallback;

      el.dTitle.textContent = item.title;
      el.dPrice.textContent = priceLabel(item.price);
      el.dDist.textContent = item.dist.toFixed(1) + " km";
      el.dDesc.textContent = item.desc;
      el.dStore.textContent = item.storeName;
      el.dAddr.textContent = item.addr;
      el.dHours.textContent = item.hours;
      el.dDate.textContent = fmtDate(item.date);
      el.saveBtn.textContent = state.saved.has(item.id) ? "Gemt ★" : "Gem";

      el.detailOverlay.classList.add("open");
    }

    function closeDetail(){
      el.detailOverlay.classList.remove("open");
      closeImageViewer();
    }

    function openFilters(){ el.filterOverlay.classList.add("open"); }
    function closeFilters(){ el.filterOverlay.classList.remove("open"); }

    function openImageViewer(){
      if(!el.dImg.src) return;
      el.fullImg.src = el.dImg.currentSrc || el.dImg.src;
      el.fullImg.alt = state.selectedItem ? "Fuldt billede af " + state.selectedItem.title : "Fuldt varebillede";
      el.imageOverlay.classList.add("open");
    }

    function closeImageViewer(){
      el.imageOverlay.classList.remove("open");
    }

    function syncFilterInputs(){
      el.store.value = state.selectedStore;
      el.sort.value = state.sort;
      el.maxPrice.value = state.maxPrice;
      el.near.value = state.near;
    }

    function switchTab(tab){
      state.activeTab = tab;
      el.tabBtns.forEach(btn => btn.classList.toggle("active", btn.dataset.tab === tab));
      Object.entries(el.panels).forEach(([key, panel]) => panel.classList.toggle("active", key === tab));
    }

    function populateStores(){
      const first = '<option value="all">Alle genbrugsbutikker</option>';
      el.store.innerHTML = first + STORES.map(s =>
        `<option value="${s.id}">${escapeHtml(s.name)} · ${escapeHtml(s.addr)}</option>`
      ).join("");
    }

    document.addEventListener("click", (e) => {
      const tabBtn = e.target.closest(".tabBtn");
      if(tabBtn) switchTab(tabBtn.dataset.tab);

      const card = e.target.closest(".card");
      if(card) openDetail(card.dataset.id);

      if(e.target.matches('[data-close="detail"]')) closeDetail();
      if(e.target.matches('[data-close="filter"]')) closeFilters();
      if(e.target.matches('[data-close="image"]')) closeImageViewer();

      if(e.target === el.detailOverlay) closeDetail();
      if(e.target === el.filterOverlay) closeFilters();
      if(e.target === el.imageOverlay) closeImageViewer();
    });

    el.q.addEventListener("input", () => {
      state.query = el.q.value;
      renderAll();
    });

    el.openFilters.addEventListener("click", () => {
      syncFilterInputs();
      openFilters();
    });

    el.detailImageWrap.addEventListener("click", openImageViewer);

    el.applyFiltersBtn.addEventListener("click", () => {
      state.selectedStore = el.store.value;
      state.sort = el.sort.value;
      state.maxPrice = el.maxPrice.value;
      state.near = el.near.value;
      closeFilters();
      renderAll();
    });

    el.resetFiltersBtn.addEventListener("click", () => {
      state.selectedStore = "all";
      state.sort = "newest";
      state.maxPrice = "";
      state.near = "all";
      syncFilterInputs();
      renderAll();
    });

    el.toggleLoginBtn.addEventListener("click", () => {
      state.isLoggedIn = !state.isLoggedIn;
      renderProfile();
      showToast(state.isLoggedIn ? "Du er logget ind igen (demo)." : "Du er nu logget ud (demo).");
    });

    el.clearSavedBtn.addEventListener("click", () => {
      state.saved.clear();
      renderAll();
      showToast("Gemte varer er nulstillet.");
    });

    el.saveBtn.addEventListener("click", () => {
      if(!state.selectedItem) return;
      if(!state.isLoggedIn){
        showToast("Log ind i demoen for at gemme varer.");
        return;
      }
      if(state.saved.has(state.selectedItem.id)){
        state.saved.delete(state.selectedItem.id);
        showToast("Vare fjernet fra gemte.");
      } else {
        state.saved.add(state.selectedItem.id);
        showToast("Vare gemt.");
      }
      el.saveBtn.textContent = state.saved.has(state.selectedItem.id) ? "Gemt ★" : "Gem";
      renderAll();
    });

    el.visitBtn.addEventListener("click", () => {
      if(!state.selectedItem) return;
      showToast(state.selectedItem.storeName + " · " + state.selectedItem.hours);
    });

    window.addEventListener("keydown", (e) => {
      if(e.key === "Escape"){
        closeDetail();
        closeFilters();
        closeImageViewer();
      }
    });

    populateStores();
    syncFilterInputs();
    switchTab("browse");
    renderAll();
  </script>
</body>
</html>