<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GenFind – demo</title>

  <style>
    :root{
      --bg: #f6f3ea;
      --surface: #fffdf7;
      --card: #ffffff;
      --text: #0b2b1e;
      --muted: #3b5a4b;
      --line: rgba(11, 43, 30, .14);

      --accent: #1f6f4a;
      --accent2:#165a3b;
      --accentSoft: rgba(31, 111, 74, .12);

      --teal: #4fb6a6;
      --teal2:#2d9e8d;

      --warm: #c57a4d;
      --chip: #f1efe6;

      --shadow: 0 10px 30px rgba(11, 43, 30, .10);
      --shadowSm: 0 6px 18px rgba(11, 43, 30, .08);
      --radius: 4px;
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 20% -10%, rgba(79,182,166,.18), transparent 55%),
        radial-gradient(900px 600px at 110% 20%, rgba(31,111,74,.18), transparent 55%),
        linear-gradient(180deg, #f7f4ec 0%, var(--bg) 40%, #f3f0e7 100%);
    }

    a{ color:inherit; text-decoration:none; }
    .container{ max-width:1100px; margin:0 auto; padding:14px; }

    header{
      position:sticky; top:0; z-index:20;
      background: rgba(246,243,234,.78);
      border-bottom: 1px solid var(--line);
      backdrop-filter: blur(10px);
    }

    .topbar{
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      padding:12px 14px;
      max-width:1100px; margin:0 auto;
    }

    .brand{
      display:flex; align-items:center; gap:10px;
      min-width:200px;
      font-weight:900;
      letter-spacing:.2px;
    }

    .logo{
      height: 76px; width:auto;
      border-radius:12px;
      box-shadow: 0 6px 16px rgba(11, 43, 30, .12);
      border: 1px solid rgba(11, 43, 30, .10);
      background: #ffffff;
    }

    .brandText{
      font-size:14px;
      color: var(--muted);
      font-weight:800;
      display:flex;
      align-items:center;
      gap:8px;
    }

    .searchRow{
      flex:1;
      display:flex; gap:8px; align-items:center;
    }

    .searchRow input, .searchRow select{
      height:40px;
      border:1px solid var(--line);
      border-radius:12px;
      padding:0 12px;
      background: rgba(255,255,255,.9);
      outline:none;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.6);
      transition: border-color .15s ease, box-shadow .15s ease, transform .15s ease;
    }

    .searchRow input{ flex:1; min-width:140px; }
    .searchRow select{ min-width: 240px; }

    .searchRow input:focus,
    .searchRow select:focus{
      border-color: rgba(31,111,74,.45);
      box-shadow: 0 0 0 4px rgba(31,111,74,.12), inset 0 1px 0 rgba(255,255,255,.6);
    }

    .btn{
      height:40px; padding:0 14px;
      border-radius:12px;
      border:1px solid var(--accent);
      background: linear-gradient(180deg, var(--accent) 0%, #1a6442 100%);
      color:#fff;
      font-weight:800;
      cursor:pointer;
      box-shadow: 0 8px 18px rgba(31,111,74,.18);
      transition: transform .12s ease, box-shadow .12s ease, background .12s ease, border-color .12s ease;
    }

    .btn:hover{
      background: linear-gradient(180deg, var(--accent2) 0%, #124f33 100%);
      border-color: var(--accent2);
      transform: translateY(-1px);
      box-shadow: 0 12px 24px rgba(31,111,74,.20);
    }

    .btn:active{ transform: translateY(0px); box-shadow: 0 8px 18px rgba(31,111,74,.18); }

    .btn.ghost{
      background: rgba(255,255,255,.85);
      color: var(--accent);
      border:1px solid var(--line);
      box-shadow: none;
    }

    .btn.ghost:hover{
      border-color: rgba(31,111,74,.28);
      box-shadow: 0 10px 22px rgba(11,43,30,.08);
      transform: translateY(-1px);
      background: rgba(255,255,255,.95);
    }

    :focus-visible{
      outline: none;
      box-shadow: 0 0 0 4px rgba(79,182,166,.22);
      border-color: rgba(79,182,166,.55);
    }

    .layout{
      display:grid;
      grid-template-columns: 260px 1fr;
      gap:14px;
      margin-top:14px;
    }

    @media (max-width: 900px){
      .layout{ grid-template-columns:1fr; }
      .sidebar{ order:2; }
      .brandText{ display:none; }
      .searchRow select{ min-width: 0; width: 100%; }
      .userText{ display:none; }
    }

    .sidebar, .main{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(255,253,247,.84);
      box-shadow: var(--shadowSm);
      overflow:hidden;
    }

    .boxHd{
      padding:10px 12px;
      border-bottom:1px solid var(--line);
      font-weight:900;
      display:flex; align-items:center; justify-content:space-between;
      background:
        linear-gradient(180deg, rgba(79,182,166,.08), rgba(79,182,166,0)),
        rgba(255,253,247,.92);
    }

    .chips{
      display:flex; gap:8px; flex-wrap:wrap;
      padding:10px 12px;
    }

    .chip{
      font-size:12px;
      background: var(--chip);
      border:1px solid var(--line);
      padding:7px 10px;
      border-radius:999px;
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, background .12s ease, border-color .12s ease, box-shadow .12s ease;
    }

    .chip:hover{
      transform: translateY(-1px);
      box-shadow: 0 10px 18px rgba(11,43,30,.08);
      border-color: rgba(31,111,74,.25);
    }

    .chip.active{
      background: var(--accentSoft);
      border-color: rgba(31,111,74,.35);
      color: var(--accent);
      font-weight:900;
      box-shadow: 0 10px 18px rgba(31,111,74,.12);
    }

    .filters{
      display:flex; gap:10px; flex-wrap:wrap;
      padding:10px 12px;
      align-items:center;
      border-bottom:1px solid var(--line);
      background: rgba(255,253,247,.92);
    }

    .filters select, .filters input{
      height:36px;
      border:1px solid var(--line);
      border-radius:12px;
      padding:0 12px;
      background: rgba(255,255,255,.9);
      outline:none;
      font-size:14px;
    }

    .filters select:focus, .filters input:focus{
      border-color: rgba(31,111,74,.45);
      box-shadow: 0 0 0 4px rgba(31,111,74,.12);
    }

    .filters small{ color: var(--muted); font-weight:700; }
    .hint{ margin-left:auto; font-size:12px; color:var(--muted); font-weight:800; }

    .grid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:12px;
      padding:12px;
    }

    @media (max-width: 900px){ .grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); } }
    @media (max-width: 560px){ .grid{ grid-template-columns: 1fr; } }

    .card{
      border:1px solid var(--line);
      border-radius: var(--radius);
      overflow:hidden;
      background: #fff;
      cursor:pointer;
      display:flex;
      flex-direction:column;
      min-height:260px;
      box-shadow: 0 10px 22px rgba(11,43,30,.08);
      transition: transform .14s ease, box-shadow .14s ease, border-color .14s ease;
    }

    .card:hover{
      transform: translateY(-2px);
      box-shadow: 0 16px 34px rgba(11,43,30,.12);
      border-color: rgba(31,111,74,.25);
    }

    .thumb{
      height:130px;
      background:
        radial-gradient(400px 180px at 20% 30%, rgba(79,182,166,.30), transparent 60%),
        radial-gradient(350px 200px at 85% 20%, rgba(197,122,77,.18), transparent 62%),
        #f7f6f0;
      border-bottom:1px solid var(--line);
      display:flex; align-items:center; justify-content:center;
      overflow:hidden;
    }

    .thumb img{ width:100%; height:100%; object-fit:cover; display:block; }

    .cardBody{ padding:10px 10px 12px; display:flex; flex-direction:column; gap:6px; }

    .title{ font-weight:900; line-height:1.2; }

    .price{
      font-weight:950;
      color: var(--accent);
      letter-spacing: .2px;
    }

    .meta{ color: var(--muted); font-size:12px; line-height:1.35; }
    .row{ display:flex; align-items:center; justify-content:space-between; gap:8px; }

    .modalBack{
      position:fixed; inset:0;
      background: rgba(11,43,30,.55);
      display:none; align-items:center; justify-content:center;
      padding:16px;
      z-index:50;
      backdrop-filter: blur(6px);
    }

    .modal{
      width:min(900px, 100%);
      background: rgba(255,253,247,.95);
      border-radius: 18px;
      border:1px solid var(--line);
      overflow:hidden;
      box-shadow: 0 30px 80px rgba(11,43,30,.25);
    }

    .modalHd{
      display:flex; justify-content:space-between; align-items:center;
      padding:10px 12px;
      border-bottom:1px solid var(--line);
      font-weight:950;
      background:
        linear-gradient(90deg, rgba(31,111,74,.12), rgba(79,182,166,.10) 55%, rgba(197,122,77,.10));
    }

    .close{
      border:1px solid var(--line);
      background: rgba(255,255,255,.85);
      height:36px; padding:0 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:900;
      transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
    }

    .close:hover{
      transform: translateY(-1px);
      box-shadow: 0 12px 22px rgba(11,43,30,.10);
      border-color: rgba(31,111,74,.22);
    }

    .modalGrid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:12px;
      padding:12px;
    }

    @media (max-width: 820px){ .modalGrid{ grid-template-columns:1fr; } }

    .bigImg{
      border:1px solid var(--line);
      border-radius: var(--radius);
      overflow:hidden;
      background:
        radial-gradient(650px 300px at 30% 30%, rgba(79,182,166,.26), transparent 60%),
        #f7f6f0;
      min-height:260px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.7);
    }

    .bigImg img{ width:100%; height:100%; object-fit:cover; display:block; }

    .panel{
      border:1px solid var(--line);
      border-radius: var(--radius);
      padding:12px;
      background:#fff;
      box-shadow: 0 10px 22px rgba(11,43,30,.08);
    }

    .panel h2{ margin:0 0 6px; font-size:18px; }
    .panel p{ margin:0 0 10px; color: var(--muted); line-height:1.4; }

    .kv{
      display:grid; gap:8px;
      font-size:14px;
    }
    .kv .k{ color: var(--muted); font-size:12px; }
    .kv .v{ font-weight:900; }

    .ctaRow{ display:flex; gap:8px; margin-top:10px; flex-wrap:wrap; }
    .ctaRow .btn{ flex:1; min-width:160px; }

    .btn.warm{
      border-color: rgba(197,122,77,.55);
      background: linear-gradient(180deg, #c57a4d 0%, #a8623a 100%);
      box-shadow: 0 10px 22px rgba(197,122,77,.20);
    }
    .btn.warm:hover{
      background: linear-gradient(180deg, #b56f45 0%, #935430 100%);
      border-color: rgba(197,122,77,.80);
      box-shadow: 0 14px 28px rgba(197,122,77,.22);
    }

    .empty{
      padding:16px;
      color: var(--muted);
    }

    /* ---------- Demo user UI + dropdown ---------- */
    .userBoxWrap{ position:relative; display:flex; align-items:center; }
    .userBox{
      display:flex;
      align-items:center;
      gap:10px;
      padding:6px 8px;
      border:1px solid var(--line);
      border-radius:14px;
      background: rgba(255,255,255,.78);
      box-shadow: 0 10px 22px rgba(11,43,30,.06);
      white-space:nowrap;
      cursor:pointer;
      user-select:none;
    }

    .avatar{
      width:36px; height:36px;
      border-radius:999px;
      display:flex; align-items:center; justify-content:center;
      font-weight:950;
      color:#fff;
      background: linear-gradient(180deg, var(--accent) 0%, #1a6442 100%);
      box-shadow: 0 10px 18px rgba(31,111,74,.18);
      flex: 0 0 auto;
    }

    .userText{ display:flex; flex-direction:column; line-height:1.05; }
    .userName{ font-weight:950; font-size:13px; }
    .userMeta{ font-size:12px; color:var(--muted); font-weight:800; }
    .caret{ color: var(--muted); font-weight:950; margin-left:2px; }

    .menu{
      position:absolute;
      top: calc(100% + 8px);
      right: 0;
      width: 240px;
      background: rgba(255,255,255,.95);
      border:1px solid var(--line);
      border-radius:14px;
      box-shadow: 0 18px 40px rgba(11,43,30,.14);
      overflow:hidden;
      display:none;
      z-index:40;
      backdrop-filter: blur(10px);
    }
    .menu.open{ display:block; }

    .menuHd{
      padding:10px 12px;
      font-weight:950;
      border-bottom:1px solid var(--line);
      background:
        linear-gradient(90deg, rgba(31,111,74,.10), rgba(79,182,166,.08) 55%, rgba(197,122,77,.08));
    }
    .menuItem{
      width:100%;
      text-align:left;
      background: transparent;
      border:0;
      padding:10px 12px;
      cursor:pointer;
      font-weight:850;
      color: var(--text);
    }
    .menuItem:hover{ background: rgba(31,111,74,.08); }
    .menuItem.danger:hover{ background: rgba(197,122,77,.10); }
    .menuSep{ height:1px; background: var(--line); }

    /* ---------- Saved overlay ---------- */
    .savedBack{
      position:fixed; inset:0;
      background: rgba(11,43,30,.55);
      display:none; align-items:center; justify-content:center;
      padding:16px;
      z-index:60;
      backdrop-filter: blur(6px);
    }
    .savedBack.open{ display:flex; }
    .savedModal{
      width:min(980px, 100%);
      background: rgba(255,253,247,.96);
      border-radius: 18px;
      border:1px solid var(--line);
      overflow:hidden;
      box-shadow: 0 30px 80px rgba(11,43,30,.25);
    }
    .savedHd{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      padding:10px 12px;
      border-bottom:1px solid var(--line);
      font-weight:950;
      background:
        linear-gradient(90deg, rgba(31,111,74,.12), rgba(79,182,166,.10) 55%, rgba(197,122,77,.10));
    }
    .savedHd .actions{ display:flex; gap:8px; flex-wrap:wrap; }
    .savedBody{ padding:12px; }
    .savedGrid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:12px;
    }
    @media (max-width: 900px){ .savedGrid{ grid-template-columns: repeat(2, minmax(0, 1fr)); } }
    @media (max-width: 560px){ .savedGrid{ grid-template-columns: 1fr; } }
  </style>
</head>

<body>
  <header>
    <div class="topbar">
      <div class="brand">
        <img class="logo" src="genfind_logo.png" alt="GenFind logo" />
      </div>

      <div class="searchRow">
        <input id="q" type="search" placeholder="Søg efter varer (fx sofa, bord, jakke)..." />
        <select id="store" title="Genbrugsbutik (valgfrit)">
          <option value="all">Alle genbrugsbutikker</option>
        </select>
        <button class="btn" id="searchBtn" type="button">Søg</button>
      </div>

      <!-- Profil + dropdown -->
      <div class="userBoxWrap" id="userWrap">
        <div class="userBox" id="profileBtn" role="button" tabindex="0" aria-haspopup="menu" aria-expanded="false" title="Demo-bruger">
          <div class="avatar" aria-hidden="true">JM</div>
          <div class="userText">
            <div class="userName" id="userName">Jens Peter Mogensen <span class="caret">▾</span></div>
            <div class="userMeta"><span id="savedCount">0</span> gemte</div>
          </div>
        </div>

        <div class="menu" id="profileMenu" role="menu" aria-label="Profilmenu">
          <div class="menuHd">Profil</div>
          <button class="menuItem" id="menuSaved" type="button" role="menuitem">Gemte varer</button>
          <div class="menuSep" aria-hidden="true"></div>
          <button class="menuItem danger" id="menuLogout" type="button" role="menuitem">Log ud (demo)</button>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="layout">
      <aside class="sidebar">
        <div class="boxHd">
          <span>Kategorier</span>
          <small id="catInfo" style="color:var(--muted); font-weight:800;"></small>
        </div>

        <div class="chips" id="cats"></div>

        <div class="empty" style="border-top:1px solid var(--line);">
          <strong>Konceptidé:</strong><br/>
          Browse genbrugsvarer online – Med mulighed for at vælge en butik, kategori og filtrér på afstand, pris og oprettelses dato.
        </div>
      </aside>

      <section class="main">
        <div class="boxHd">
          <span>Vare</span>
          <small id="count" style="color:var(--muted); font-weight:800;"></small>
        </div>

        <div class="filters">
          <small>Sortér:</small>
          <select id="sort">
            <option value="newest">Nyeste</option>
            <option value="distance">Afstand</option>
            <option value="price_asc">Pris (lav → høj)</option>
            <option value="price_desc">Pris (høj → lav)</option>
          </select>

          <small>Max pris:</small>
          <input id="maxPrice" type="number" min="0" step="10" placeholder="fx 300" style="width:120px" />

          <small>Kun nær mig:</small>
          <select id="near">
            <option value="all">Alle</option>
            <option value="1">≤ 1 km</option>
            <option value="2">≤ 2 km</option>
            <option value="3">≤ 3 km</option>
            <option value="4">≤ 4 km</option>
            <option value="5">≤ 5 km</option>
            <option value="10">≤ 10 km</option>
            <option value="25">≤ 25 km</option>
          </select>

          <span class="hint" id="locHint"></span>
        </div>

        <div id="grid" class="grid"></div>
        <div id="empty" class="empty" style="display:none;">Ingen resultater. Prøv at ændre søgning/filtre.</div>
      </section>
    </div>
  </div>

  <!-- Detail modal -->
  <div class="modalBack" id="modalBack" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Annonce">
      <div class="modalHd">
        <span>Annonce</span>
        <button class="close" id="closeModal" type="button">Luk</button>
      </div>

      <div class="modalGrid">
        <div class="bigImg"><img id="dImg" alt="Billede af varen"></div>

        <div class="panel">
          <div class="row">
            <h2 id="dTitle" style="margin:0;">Titel</h2>
          </div>

          <div class="price" id="dPrice" style="font-size:18px; margin:6px 0 8px;">0 kr.</div>
          <p id="dDesc">Beskrivelse…</p>

          <div class="kv">
            <div>
              <div class="k">Butik</div>
              <div class="v" id="dStore">—</div>
            </div>
            <div>
              <div class="k">Adresse</div>
              <div class="v" id="dAddr">—</div>
            </div>
            <div>
              <div class="k">Åbningstid</div>
              <div class="v" id="dHours">—</div>
            </div>
            <div>
              <div class="k">Afstand (demo)</div>
              <div class="v" id="dDist">—</div>
            </div>
          </div>

          <div class="ctaRow">
            <button class="btn warm" id="visitBtn" type="button">Planlæg besøg</button>
            <button class="btn ghost" id="saveBtn" type="button" style="border:1px solid var(--line); color:var(--accent);">Gem</button>
          </div>

          <p style="margin:10px 0 0; font-size:12px; color:var(--muted);">
            *Demo: Afstand beregnes ud fra en fiktiv GPS-position (Aarhus H).
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Gemte varer overlay -->
  <div class="savedBack" id="savedBack" aria-hidden="true">
    <div class="savedModal" role="dialog" aria-modal="true" aria-label="Gemte varer">
      <div class="savedHd">
        <span>Gemte varer</span>
        <div class="actions">
          <button class="btn ghost" id="clearSavedBtn" type="button" title="Nulstil gemte varer">Nulstil gemte</button>
          <button class="close" id="closeSaved" type="button">Luk</button>
        </div>
      </div>
      <div class="savedBody">
        <div id="savedEmpty" class="empty" style="display:none;">Du har ingen gemte varer endnu.</div>
        <div id="savedGrid" class="savedGrid"></div>
      </div>
    </div>
  </div>

  <script>
    // ---------- Demo: fiktiv GPS-lokation ----------
    const USER_LOCATION = {
      label: "Aarhus H (demo)",
      lat: 56.1502,
      lon: 10.2046
    };

    // ---------- Demo user ----------
    const CURRENT_USER = {
      id: "demo_jens_peter_mogensen",
      name: "Jens Peter Mogensen"
    };
    let isLoggedIn = true;

    // ---------- Genbrugsbutikker ----------
    const STORES = [
      { id:"rk_noerrealle_30", name:"Røde Kors", addr:"Nørre Allé 30, 8000 Aarhus", lat:56.1627, lon:10.2126, hours:"08:00–20:00" },
      { id:"rk_silkeborgvej_236", name:"Røde Kors", addr:"Silkeborgvej 236, 8230 Åbyhøj", lat:56.1648, lon:10.1527, hours:"10:00–17:00" },
      { id:"kk_noerrealle_25", name:"Kirkens Korshær", addr:"Nørre Allé 25, 8000 Aarhus", lat:56.1623, lon:10.2116, hours:"09:00–18:00" },
      { id:"kk_vestergade_37", name:"Kirkens Korshær", addr:"Vestergade 37, 8000 Aarhus", lat:56.1557, lon:10.2027, hours:"10:00–16:00" }
    ];

    // ---------- Minimal demo-data ----------
    const CATS = [
      {id:"alle", name:"Alle"},
      {id:"mobler", name:"Møbler"},
      {id:"toj", name:"Tøj"},
      {id:"elektronik", name:"Elektronik"},
      {id:"boger", name:"Bøger"},
      {id:"bolig", name:"Bolig & pynt"},
    ];

    function imgData(title){
      const t = String(title).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
      const svg = `
        <svg xmlns="http://www.w3.org/2000/svg" width="900" height="560">
          <defs>
            <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#1f6f4a" stop-opacity="0.78"/>
              <stop offset="0.55" stop-color="#4fb6a6" stop-opacity="0.72"/>
              <stop offset="1" stop-color="#c57a4d" stop-opacity="0.55"/>
            </linearGradient>
            <radialGradient id="r" cx="30%" cy="25%" r="75%">
              <stop offset="0" stop-color="#ffffff" stop-opacity="0.75"/>
              <stop offset="1" stop-color="#ffffff" stop-opacity="0"/>
            </radialGradient>
          </defs>
          <rect width="100%" height="100%" fill="#f7f6f0"/>
          <rect width="100%" height="100%" fill="url(#g)" opacity="0.25"/>
          <rect width="100%" height="100%" fill="url(#r)" />
          <rect x="44" y="44" width="812" height="472" rx="28"
                fill="rgba(255,255,255,0.88)"
                stroke="rgba(11,43,30,0.12)"/>
          <text x="78" y="170" font-family="system-ui, -apple-system, Segoe UI" font-size="44"
                font-weight="900" fill="#0b2b1e">${t}</text>
          <text x="78" y="225" font-family="system-ui, -apple-system, Segoe UI" font-size="22"
                fill="#3b5a4b">Billedplads (demo)</text>
        </svg>`;
      return "data:image/svg+xml;charset=utf-8," + encodeURIComponent(svg);
    }

    const ITEMS = [
      {id:"1", cat:"mobler", title:"Vintage sofabord", price:null, storeId:"rk_noerrealle_30", desc:"Egetræsbord i god stand. Små brugsspor.", date:"2026-02-19", img:"images/vintage_sofabord.jpg"},
      {id:"2", cat:"toj", title:"Uldfrakke (L)", price:220, storeId:"rk_noerrealle_30", desc:"Klassisk uldfrakke. Varm og pæn stand.", date:"2026-02-18", img:"images/uldfrakke.jpg"},
      {id:"3", cat:"bolig", title:"Keramikvase", price:110, storeId:"rk_noerrealle_30", desc:"Håndlavet vase med glasur.", date:"2026-02-17", img:"images/keramikvase.jpg"},
      {id:"4", cat:"mobler", title:"Træreol", price:180, storeId:"rk_silkeborgvej_236", desc:"Enkel reol med 4 hylder. Stabil og solid.", date:"2026-02-18", img:"images/traereol.jpg"},
      {id:"5", cat:"elektronik", title:"27\" skærm", price:350, storeId:"rk_silkeborgvej_236", desc:"HDMI. Testet og fungerer.", date:"2026-02-15", img:"images/27tommer_skaerm.jpg"},
      {id:"6", cat:"boger", title:"Børnebogsamling (6 stk.)", price:90, storeId:"rk_silkeborgvej_236", desc:"Farverige bøger – fine sider.", date:"2026-02-16", img:"images/boerneboeger.jpg"},
      {id:"7", cat:"mobler", title:"Retro lænestol", price:450, storeId:"kk_noerrealle_25", desc:"Grøn lænestol. God komfort.", date:"2026-02-17", img:"images/retro_laenestol.jpg"},
      {id:"8", cat:"toj", title:"Denimjakke", price:120, storeId:"kk_noerrealle_25", desc:"Klassisk denimjakke. Pæn stand.", date:"2026-02-16", img:"images/denimjakke.jpg"},
      {id:"9", cat:"boger", title:"Krimi-bogpakke (5 stk.)", price:80, storeId:"kk_vestergade_37", desc:"5 krimier. Fine rygge.", date:"2026-02-18", img:"images/krimi_boeger.jpg"},
      {id:"10", cat:"bolig", title:"Messinglysestager (2 stk.)", price:140, storeId:"kk_vestergade_37", desc:"Smuk patina – klassisk look.", date:"2026-02-19", img:"images/messing_lysestager.jpg"},
      {id:"11", cat:"bolig", title:"Spejl (test: intet billede og pris)", storeId:"rk_noerrealle_30", desc:"Test af manglende pris og billede", date:"2026-02-18", img:"images/spejl.jpg"}
    ].map(x => ({ ...x, img: x.img || imgData(x.title) }));

    // ---------- State ----------
    let activeCat = "alle";
    let saved = new Set(JSON.parse(localStorage.getItem("genfind_saved_simple") || "[]"));

    // ---------- Elements ----------
    const catsEl = document.getElementById("cats");
    const gridEl = document.getElementById("grid");
    const emptyEl = document.getElementById("empty");
    const countEl = document.getElementById("count");
    const catInfoEl = document.getElementById("catInfo");

    const qEl = document.getElementById("q");
    const storeEl = document.getElementById("store");
    const sortEl = document.getElementById("sort");
    const maxPriceEl = document.getElementById("maxPrice");
    const nearEl = document.getElementById("near");
    const locHintEl = document.getElementById("locHint");

    const modalBack = document.getElementById("modalBack");
    const closeModal = document.getElementById("closeModal");
    const dImg = document.getElementById("dImg");
    const dTitle = document.getElementById("dTitle");
    const dPrice = document.getElementById("dPrice");
    const dDesc = document.getElementById("dDesc");
    const dStore = document.getElementById("dStore");
    const dHours = document.getElementById("dHours");
    const dAddr = document.getElementById("dAddr");
    const dDist = document.getElementById("dDist");
    const visitBtn = document.getElementById("visitBtn");
    const saveBtn = document.getElementById("saveBtn");

    const profileBtn = document.getElementById("profileBtn");
    const profileMenu = document.getElementById("profileMenu");
    const menuSaved = document.getElementById("menuSaved");
    const menuLogout = document.getElementById("menuLogout");
    const userNameEl = document.getElementById("userName");
    const savedCountEl = document.getElementById("savedCount");

    const savedBack = document.getElementById("savedBack");
    const savedGrid = document.getElementById("savedGrid");
    const savedEmpty = document.getElementById("savedEmpty");
    const closeSaved = document.getElementById("closeSaved");
    const clearSavedBtn = document.getElementById("clearSavedBtn");

    // ---------- Distance helpers ----------
    function toRad(x){ return x * Math.PI / 180; }
    function distanceKm(a, b){
      const R = 6371;
      const dLat = toRad(b.lat - a.lat);
      const dLon = toRad(b.lon - a.lon);
      const lat1 = toRad(a.lat);
      const lat2 = toRad(b.lat);

      const s1 = Math.sin(dLat/2);
      const s2 = Math.sin(dLon/2);
      const h = s1*s1 + Math.cos(lat1)*Math.cos(lat2)*s2*s2;
      return 2 * R * Math.asin(Math.min(1, Math.sqrt(h)));
    }

    function storeById(id){
      return STORES.find(s => s.id === id) || null;
    }

    // ---------- Render helpers ----------
    function renderStoreOptions(){
      const keepFirst = storeEl.querySelector('option[value="all"]');
      storeEl.innerHTML = "";
      storeEl.appendChild(keepFirst);

      STORES.forEach(s => {
        const opt = document.createElement("option");
        opt.value = s.id;
        opt.textContent = `${s.name} · ${s.addr}`;
        storeEl.appendChild(opt);
      });
    }

    function renderCats(){
      catsEl.innerHTML = "";
      CATS.forEach(c => {
        const chip = document.createElement("div");
        chip.className = "chip" + (activeCat === c.id ? " active" : "");
        chip.textContent = c.name;
        chip.onclick = () => { activeCat = c.id; renderCats(); render(); };
        catsEl.appendChild(chip);
      });
      catInfoEl.textContent = (activeCat === "alle") ? "" : "Valgt: " + (CATS.find(c=>c.id===activeCat)?.name || "");
    }

    function decorateItems(list){
      return list.map(x => {
        const s = storeById(x.storeId);
        const dist = s ? distanceKm(USER_LOCATION, s) : 999;
        return {
          ...x,
          storeName: s ? s.name : "Ukendt butik",
          addr: s ? s.addr : "—",
          hours: s ? (s.hours || "Åbningstid ikke angivet") : "Åbningstid ikke angivet",
          dist
        };
      });
    }

    function hasPrice(p){
      return p !== null && p !== undefined && p !== "" && Number.isFinite(Number(p));
    }

    function priceLabel(p){
      return hasPrice(p) ? `${Number(p)} kr.` : "Pris ikke angivet";
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function updateUserUI(){
      if(userNameEl) userNameEl.textContent = isLoggedIn ? (CURRENT_USER.name + " ▾") : "Ikke logget ind ▾";
      if(savedCountEl) savedCountEl.textContent = String(saved.size);

      // menu items enabled/disabled (enkelt demo)
      menuSaved.disabled = !isLoggedIn;
      clearSavedBtn.disabled = !isLoggedIn;
    }

    function persistSaved(){
      localStorage.setItem("genfind_saved_simple", JSON.stringify([...saved]));
      updateUserUI();
    }

    // ---------- Main list ----------
    function filtered(){
      const q = (qEl.value || "").trim().toLowerCase();
      const maxPrice = Number(maxPriceEl.value || 0);
      const near = nearEl.value === "all" ? null : Number(nearEl.value);
      const selectedStore = storeEl.value;

      let list = decorateItems(ITEMS);

      if(activeCat !== "alle") list = list.filter(x => x.cat === activeCat);
      if(selectedStore !== "all") list = list.filter(x => x.storeId === selectedStore);

      if(q){
        list = list.filter(x =>
          x.title.toLowerCase().includes(q) ||
          x.desc.toLowerCase().includes(q) ||
          x.storeName.toLowerCase().includes(q) ||
          x.addr.toLowerCase().includes(q)
        );
      }

      if(maxPrice > 0){
        list = list.filter(x => !hasPrice(x.price) || Number(x.price) <= maxPrice);
      }

      if(near !== null){
        list = list.filter(x => x.dist <= near);
      }

      switch(sortEl.value){
        case "newest":
          list.sort((a,b)=> new Date(b.date) - new Date(a.date));
          break;
        case "distance":
          list.sort((a,b)=> a.dist - b.dist);
          break;
        case "price_asc":
          list.sort((a,b)=> {
            const ap = hasPrice(a.price) ? Number(a.price) : Infinity;
            const bp = hasPrice(b.price) ? Number(b.price) : Infinity;
            return ap - bp;
          });
          break;
        case "price_desc":
          list.sort((a,b)=> {
            const ap = hasPrice(a.price) ? Number(a.price) : -Infinity;
            const bp = hasPrice(b.price) ? Number(b.price) : -Infinity;
            return bp - ap;
          });
          break;
      }

      return list;
    }

    function render(){
      locHintEl.textContent = `Min lokation: ${USER_LOCATION.label}`;
      updateUserUI();

      const list = filtered();
      countEl.textContent = list.length + " varer";
      gridEl.innerHTML = "";
      emptyEl.style.display = list.length ? "none" : "block";

      list.forEach(x => {
        const el = document.createElement("div");
        el.className = "card";
        el.innerHTML = `
          <div class="thumb">
            <img src="${x.img}"
                 alt="Billede af ${escapeHtml(x.title)}"
                 onerror="this.onerror=null; this.src='${imgData("Intet billede")}'">
          </div>
          <div class="cardBody">
            <div class="row">
              <div class="title">${escapeHtml(x.title)}</div>
            </div>
            <div class="row">
              <div class="price">${priceLabel(x.price)}</div>
              <div class="meta">${x.dist.toFixed(1)} km</div>
            </div>
            <div class="meta">${escapeHtml(x.storeName)} · ${escapeHtml(x.addr)}</div>
          </div>
        `;
        el.onclick = () => openDetail(x);
        gridEl.appendChild(el);
      });
    }

    // ---------- Detail modal ----------
    function openDetail(x){
      dImg.onerror = () => { dImg.onerror = null; dImg.src = imgData("Intet billede"); };
      dImg.src = x.img;

      dTitle.textContent = x.title;
      dPrice.textContent = priceLabel(x.price);
      dDesc.textContent = x.desc;

      dStore.textContent = x.storeName;
      dAddr.textContent = x.addr;
      dHours.textContent = x.hours || "Åbningstid ikke angivet";
      dDist.textContent = x.dist.toFixed(1) + " km (demo)";

      // Gem-knappen virker kun når "logget ind" (demo)
      if(!isLoggedIn){
        saveBtn.textContent = "Log ind for at gemme (demo)";
        saveBtn.onclick = () => alert("Demo: Du er logget ud. Log ind-funktion kan tilføjes senere.");
      } else {
        saveBtn.textContent = saved.has(x.id) ? "Gemt ★" : "Gem";
        saveBtn.onclick = () => {
          if(saved.has(x.id)) saved.delete(x.id); else saved.add(x.id);
          persistSaved();
          saveBtn.textContent = saved.has(x.id) ? "Gemt ★" : "Gem";
        };
      }

      visitBtn.onclick = () => {
        alert(
          "Planlæg besøg:\n\n" +
          x.storeName + "\n" +
          x.addr + "\nÅbningstid: " + (x.hours || "Åbningstid ikke angivet") + "\n\n(" +
          x.dist.toFixed(1) + " km fra " + USER_LOCATION.label + " – demo)"
        );
      };

      modalBack.style.display = "flex";
      modalBack.setAttribute("aria-hidden", "false");
      closeModal.focus();
    }

    function closeDetail(){
      modalBack.style.display = "none";
      modalBack.setAttribute("aria-hidden", "true");
    }

    // ---------- Profile dropdown ----------
    function openMenu(){
      profileMenu.classList.add("open");
      profileBtn.setAttribute("aria-expanded", "true");
    }
    function closeMenu(){
      profileMenu.classList.remove("open");
      profileBtn.setAttribute("aria-expanded", "false");
    }
    function toggleMenu(){
      const isOpen = profileMenu.classList.contains("open");
      if(isOpen) closeMenu(); else openMenu();
    }

    // ---------- Saved overlay ----------
    function openSaved(){
      if(!isLoggedIn){
        alert("Demo: Du er logget ud.");
        return;
      }
      renderSavedList();
      savedBack.classList.add("open");
      savedBack.setAttribute("aria-hidden", "false");
      closeMenu();
    }

    function closeSavedOverlay(){
      savedBack.classList.remove("open");
      savedBack.setAttribute("aria-hidden", "true");
    }

    function renderSavedList(){
      const savedIds = new Set([...saved]);
      const list = decorateItems(ITEMS).filter(x => savedIds.has(x.id));

      savedGrid.innerHTML = "";
      savedEmpty.style.display = list.length ? "none" : "block";

      // genbrug card-UI men i saved-grid
      list.forEach(x => {
        const el = document.createElement("div");
        el.className = "card";
        el.innerHTML = `
          <div class="thumb">
            <img src="${x.img}"
                 alt="Billede af ${escapeHtml(x.title)}"
                 onerror="this.onerror=null; this.src='${imgData("Intet billede")}'">
          </div>
          <div class="cardBody">
            <div class="row">
              <div class="title">${escapeHtml(x.title)}</div>
            </div>
            <div class="row">
              <div class="price">${priceLabel(x.price)}</div>
              <div class="meta">${x.dist.toFixed(1)} km</div>
            </div>
            <div class="meta">${escapeHtml(x.storeName)} · ${escapeHtml(x.addr)}</div>
          </div>
        `;
        el.onclick = () => {
          closeSavedOverlay();
          openDetail(x);
        };
        savedGrid.appendChild(el);
      });
    }

    function clearSavedOnlyInSavedView(){
      // Nulstil kun herinde:
      saved.clear();
      persistSaved();
      renderSavedList();
      render(); // opdater tæller + evt. UI
    }

    // ---------- Events ----------
    document.getElementById("searchBtn").onclick = render;
    [qEl, storeEl, sortEl, maxPriceEl, nearEl].forEach(el => {
      el.addEventListener(el === qEl ? "input" : "change", render);
    });

    closeModal.onclick = closeDetail;
    modalBack.addEventListener("click", (e)=>{ if(e.target === modalBack) closeDetail(); });

    // Profil dropdown toggle
    profileBtn.addEventListener("click", (e)=> {
      e.stopPropagation();
      toggleMenu();
    });
    profileBtn.addEventListener("keydown", (e)=>{
      if(e.key === "Enter" || e.key === " "){
        e.preventDefault();
        toggleMenu();
      }
      if(e.key === "Escape") closeMenu();
    });

    // Menu items
    menuSaved.onclick = openSaved;

    menuLogout.onclick = () => {
      // Demo-logud: skjul menu og gør gem-knap utilgængelig
      isLoggedIn = false;
      closeMenu();
      updateUserUI();
      alert("Du er nu logget ud (demo).");
      // Bemærk: gemte varer bliver liggende i localStorage som demo.
    };

    // Klik udenfor lukker menu
    document.addEventListener("click", ()=> closeMenu());

    // Escape lukker menu + overlays
    window.addEventListener("keydown", (e)=>{
      if(e.key === "Escape"){
        closeMenu();
        if(savedBack.classList.contains("open")) closeSavedOverlay();
        if(modalBack.style.display === "flex") closeDetail();
      }
    });

    // Saved overlay events
    closeSaved.onclick = closeSavedOverlay;
    savedBack.addEventListener("click", (e)=>{ if(e.target === savedBack) closeSavedOverlay(); });
    clearSavedBtn.onclick = clearSavedOnlyInSavedView;

    // ---------- Init ----------
    renderStoreOptions();
    renderCats();
    updateUserUI();
    render();
  </script>
</body>
</html>
